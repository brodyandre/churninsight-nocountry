from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, accuracy_score

# Instanciando Random Forest com peso balanceado para lidar com classes desiguais
rf_final = RandomForestClassifier(
    n_estimators=200, 
    max_depth=12, 
    class_weight='balanced', 
    random_state=42
)

# Treinamento
rf_final.fit(X_train, y_train)

# Avaliação com foco em RECALL (Capacidade de encontrar clientes que vão sair)
y_pred = rf_final.predict(X_test)
print(f"Acurácia Geral: {accuracy_score(y_test, y_pred):.4f}")
print(classification_report(y_test, y_pred))

# Importância das Variáveis: Insight para o negócio
importancias = pd.Series(rf_final.feature_importances_, index=X_train.columns)
importancias.nlargest(10).plot(kind='barh', title='Top 10 Fatores de Risco de Churn')
