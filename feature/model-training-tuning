from sklearn.ensemble import RandomForestClassifier
from sklearn.pipeline import Pipeline
from sklearn.model_selection import GridSearchCV

# Criando o Pipeline completo
pipe = Pipeline([
    ('preprocessor', preprocessor),
    ('rf', RandomForestClassifier(random_state=42, class_weight='balanced'))
])

# Par√¢metros para o Tuning
param_grid = {
    'rf__n_estimators': [100, 200],
    'rf__max_depth': [10, 15, None],
    'rf__min_samples_split': [2, 5]
}

# Busca focada em RECALL
grid_search = GridSearchCV(pipe, param_grid, cv=3, scoring='recall', n_jobs=-1)
grid_search.fit(X_train, y_train) # Note que agora passamos X_train RAW porque o pipeline trata tudo!

print(f"Melhor Recall encontrado: {grid_search.best_score_:.4f}")
